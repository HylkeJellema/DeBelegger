<!doctype html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Box 3 Belasting Simulatie</title>
    <meta
      name="description"
      content="Bereken en vergelijk Box 3 belasting op je vermogen met historische AEX, S&P 500 en All World data. Zie direct het verschil tussen oud, huidig en toekomstig stelsel."
    />
    <meta property="og:title" content="Box 3 Belasting Simulatie" />
    <meta
      property="og:description"
      content="Bereken en vergelijk Box 3 belasting op je vermogen met historische AEX, S&P 500 en All World data."
    />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="nl_NL" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-inner">
        <p class="header-credit">
          Made by
          <a href="https://www.linkedin.com/in/hylkej/" target="_blank" rel="noopener noreferrer">Hylke</a>
        </p>
        <button type="button" class="algo-info-toggle" id="algoInfoToggle">Hoe werkt het? ▾</button>
        <div class="logo">
          <img src="/assets/logo.png" alt="DeBelegger" class="logo-icon-img" />
          <h1>Box 3 <span class="accent">Belasting Simulatie</span></h1>
        </div>
        <p class="header-subtitle">
          Vergelijk de impact van Box 3 belasting op je vermogen
        </p>
      </div>
    </header>

    <!-- Algorithm Information Section -->
    <div class="algo-info-panel" id="algoInfoPanel" aria-hidden="true">
      <div class="algo-info-inner">
        <div class="algo-close-row">
          <h2 class="algo-info-title">Technische Documentatie — Rekenalgoritmen</h2>
          <button type="button" class="modal-close" id="algoInfoClose" aria-label="Sluiten">x</button>
        </div>

        <!-- Simulation Engine -->
        <div class="algo-block">
          <h3>1. Simulatie-engine</h3>
          <p>De simulator loopt jaar voor jaar door de geselecteerde historische rendementen. Per jaar worden de volgende stappen doorlopen voor <em>elk</em> belastingregime parallel:</p>
          <div class="algo-steps">
            <div class="algo-step">
              <span class="algo-step-num">1.1</span>
              <div>
                <strong>Peildatum (1 januari)</strong>
                <p>De portfoliowaarde aan het begin van het jaar (<code>prevValue</code>) dient als grondslag voor de belastingberekening. Dit reflecteert de wettelijke peildatum van 1 januari.</p>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">1.2</span>
              <div>
                <strong>Maandelijks rendement &amp; inleg</strong>
                <p>Het jaarrendement <code>r</code> wordt omgerekend naar een maandelijks rendement via de formule:</p>
                <pre class="algo-formula">monthlyFactor = (1 + r)<sup>1/12</sup></pre>
                <p>Vervolgens wordt per maand het vermogen gecompound en de maandelijkse inleg toegevoegd (einde maand):</p>
                <pre class="algo-formula">V<sub>m+1</sub> = V<sub>m</sub> × monthlyFactor + inleg</pre>
                <p>Als er geen inleg is, wordt het directe jaarrendement toegepast: <code>V × (1 + r)</code>.</p>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">1.3</span>
              <div>
                <strong>Werkelijk rendement</strong>
                <p>Het werkelijke rendement wordt berekend exclusief de stortingen:</p>
                <pre class="algo-formula">rendement = V<sub>einde</sub> − V<sub>begin</sub> − (inleg × 12)</pre>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">1.4</span>
              <div>
                <strong>Belastingberekening</strong>
                <p>Per regime wordt de belasting berekend (zie secties hieronder). De belasting mag nooit hoger zijn dan de portfoliowaarde:</p>
                <pre class="algo-formula">belasting = min(berekende belasting, max(0, V<sub>einde</sub>))</pre>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">1.5</span>
              <div>
                <strong>Waarde na belasting</strong>
                <p>Het eindvermogen van het jaar wordt de startwaarde van het volgende jaar:</p>
                <pre class="algo-formula">V<sub>na belasting</sub> = V<sub>einde</sub> − belasting</pre>
              </div>
            </div>
          </div>
        </div>

        <!-- CPI Correction -->
        <div class="algo-block">
          <h3>2. CPI-correctie (optioneel)</h3>
          <p>Wanneer de CPI-toggle actief is, wordt de maandelijkse inleg jaarlijks gecorrigeerd voor inflatie op basis van historische CPI-data van het CBS. De inleg in jaar <code>t</code> wordt berekend als:</p>
          <pre class="algo-formula">inleg<sub>t</sub> = basisinleg × ∏<sub>j=startjaar</sub><sup>t</sup> (1 + CPI<sub>j</sub> / 100)</pre>
          <p>Dit simuleert het scenario waarin je jaarlijks je inleg opschroeft met de inflatie, zodat je koopkracht constant blijft.</p>
        </div>

        <hr class="algo-divider" />

        <!-- Old System -->
        <div class="algo-block">
          <h3>3. Oud systeem (vóór 2017)</h3>
          <p>Het oude Box 3-stelsel werkte met een <strong>vast forfaitair rendement</strong>, ongeacht de werkelijke samenstelling van het vermogen.</p>
          <table class="algo-params-table">
            <thead><tr><th>Parameter</th><th>Beschrijving</th></tr></thead>
            <tbody>
              <tr><td>Forfaitair rendement</td><td>Fictief rendement dat op het belastbare vermogen wordt toegepast</td></tr>
              <tr><td>Belastingtarief</td><td>Vast tarief over het forfaitaire inkomen</td></tr>
              <tr><td>Heffingsvrij vermogen</td><td>Per persoon; bij fiscale partner verdubbeld</td></tr>
            </tbody>
          </table>
          <div class="algo-steps">
            <div class="algo-step">
              <span class="algo-step-num">a</span>
              <div>
                <strong>Belastbaar vermogen</strong>
                <pre class="algo-formula">belastbaar = max(0, vermogen − heffingsvrij × partnerMultiplier)</pre>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">b</span>
              <div>
                <strong>Forfaitair inkomen</strong>
                <pre class="algo-formula">inkomen = belastbaar × (forfaitair rendement / 100)</pre>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">c</span>
              <div>
                <strong>Belasting</strong>
                <pre class="algo-formula">belasting = max(0, inkomen × tarief / 100)</pre>
              </div>
            </div>
          </div>
        </div>

        <hr class="algo-divider" />

        <!-- Old Method 2017-2022 -->
        <div class="algo-block">
          <h3>4. Oude methode (2017–2022)</h3>
          <p>Het systeem van 2017–2022 verdeelt de grondslag sparen en beleggen over <strong>3 schijven</strong>. Per schijf wordt een fictieve mix van spaargeld en beleggingen verondersteld, met elk hun eigen forfaitair rendementspercentage. Alle parameters wijzigen per jaar.</p>
          <table class="algo-params-table">
            <thead><tr><th>Parameter</th><th>Beschrijving</th></tr></thead>
            <tbody>
              <tr><td>Schijf 1 grens</td><td>Bovengrens grondslag voor schijf 1 (per jaar verschillend)</td></tr>
              <tr><td>Schijf 2 grens</td><td>Bovengrens grondslag voor schijf 2</td></tr>
              <tr><td>Spaartarief</td><td>Fictief rendement op het spaardeel (kan negatief zijn vanaf 2022)</td></tr>
              <tr><td>Beleggingstarief</td><td>Fictief rendement op het beleggingsdeel</td></tr>
              <tr><td>Belastingtarief</td><td>30% (2017-2020) of 31% (2021-2022)</td></tr>
              <tr><td>Heffingsvrij vermogen</td><td>Per persoon; bij fiscale partner verdubbeld</td></tr>
            </tbody>
          </table>
          <div class="algo-steps">
            <div class="algo-step">
              <span class="algo-step-num">a</span>
              <div>
                <strong>Grondslag sparen en beleggen</strong>
                <pre class="algo-formula">grondslag = max(0, vermogen − heffingsvrij × partnerMultiplier)</pre>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">b</span>
              <div>
                <strong>Verdeling over schijven</strong>
                <pre class="algo-formula">schijf 1 = min(grondslag, grens₁)
schijf 2 = min(max(0, grondslag − grens₁), grens₂ − grens₁)
schijf 3 = max(0, grondslag − grens₂)</pre>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">c</span>
              <div>
                <strong>Fictief rendement per schijf</strong>
                <p>Per schijf wordt de fictieve mix (spaar/beleg) vermenigvuldigd met het bijbehorende rendement:</p>
                <pre class="algo-formula">rendement<sub>i</sub> = bedrag<sub>i</sub> × (spaaraandeel<sub>i</sub> × spaartarief + belegaandeel<sub>i</sub> × belegtarief)</pre>
                <p>Schijf 1: 67% sparen / 33% beleggen. Schijf 2: 21% / 79%. Schijf 3: 0% / 100%.</p>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">d</span>
              <div>
                <strong>Belasting</strong>
                <pre class="algo-formula">belasting = max(0, Σ rendement<sub>i</sub>) × tarief / 100</pre>
              </div>
            </div>
          </div>
        </div>

        <hr class="algo-divider" />

        <!-- Current System -->
        <div class="algo-block">
          <h3>5. Huidig systeem — Overbruggingswet</h3>
          <p>Het huidige stelsel verdeelt het vermogen in drie categorieën, elk met een eigen <strong>forfaitair rendementspercentage</strong>. De percentages worden jaarlijks vastgesteld op basis van werkelijke marktrendementen.</p>
          <table class="algo-params-table">
            <thead><tr><th>Parameter</th><th>Beschrijving</th></tr></thead>
            <tbody>
              <tr><td>Belastingtarief</td><td>Vast tarief over het voordeel uit sparen en beleggen</td></tr>
              <tr><td>Heffingsvrij vermogen</td><td>Per persoon; bij fiscale partner verdubbeld</td></tr>
              <tr><td>Drempel schulden</td><td>Per persoon; schulden onder de drempel tellen niet mee</td></tr>
              <tr><td>Forfait spaargeld</td><td>Fictief rendement op spaargeld</td></tr>
              <tr><td>Forfait beleggingen</td><td>Fictief rendement op beleggingen</td></tr>
              <tr><td>Forfait schulden</td><td>Aftrekbaar fictief rendement op schulden</td></tr>
            </tbody>
          </table>
          <div class="algo-steps">
            <div class="algo-step">
              <span class="algo-step-num">a</span>
              <div>
                <strong>Vermogensmix normaliseren</strong>
                <p>De procentuele verdeling over spaargeld, beleggingen en schulden wordt genormaliseerd tot 100%:</p>
                <pre class="algo-formula">share<sub>i</sub> = alloc<sub>i</sub> / Σ alloc</pre>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">b</span>
              <div>
                <strong>Porties en aftrekbare schuld</strong>
                <pre class="algo-formula">spaarportion = vermogen × share<sub>sparen</sub>
beleggingportion = vermogen × share<sub>beleggen</sub>
schuldportion = vermogen × share<sub>schuld</sub>
aftrekbare schuld = max(0, schuldportion − drempel × partnerMultiplier)</pre>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">c</span>
              <div>
                <strong>Forfaitair rendement (totaal)</strong>
                <pre class="algo-formula">forfaitair = spaarportion × forfait<sub>sparen</sub> + beleggingportion × forfait<sub>beleggen</sub> − aftrekbare schuld × forfait<sub>schuld</sub></pre>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">d</span>
              <div>
                <strong>Rendementsgrondslag</strong>
                <pre class="algo-formula">grondslag = spaarportion + beleggingportion − aftrekbare schuld</pre>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">e</span>
              <div>
                <strong>Grondslag sparen &amp; beleggen</strong>
                <pre class="algo-formula">grondslag S&B = max(0, grondslag − heffingsvrij × partnerMultiplier)</pre>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">f</span>
              <div>
                <strong>Voordeel uit sparen en beleggen</strong>
                <pre class="algo-formula">aandeel = min(1, grondslag S&B / grondslag)
voordeel = forfaitair × aandeel</pre>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">g</span>
              <div>
                <strong>Belasting</strong>
                <pre class="algo-formula">belasting = max(0, voordeel × tarief / 100)</pre>
              </div>
            </div>
          </div>
        </div>

        <hr class="algo-divider" />

        <!-- Future System -->
        <div class="algo-block">
          <h3>6. Toekomstig systeem (2028+)</h3>
          <p>Het voorgestelde nieuwe stelsel belast het <strong>werkelijke rendement</strong> in plaats van een fictief rendement. Het bevat een heffingsvrij resultaat en een verliesverrekeningssysteem (carry-forward).</p>
          <table class="algo-params-table">
            <thead><tr><th>Parameter</th><th>Beschrijving</th></tr></thead>
            <tbody>
              <tr><td>Belastingtarief</td><td>Tarief over het belastbaar inkomen</td></tr>
              <tr><td>Heffingsvrij resultaat</td><td>Per persoon; wordt alleen afgetrokken bij positief rendement</td></tr>
              <tr><td>Verliesdrempel</td><td>Per persoon; verlies wordt alleen geregistreerd als het groter is dan deze drempel</td></tr>
            </tbody>
          </table>
          <div class="algo-steps">
            <div class="algo-step">
              <span class="algo-step-num">a</span>
              <div>
                <strong>Stap 1 — Inkomen na heffingsvrij resultaat</strong>
                <p>Bij positief werkelijk rendement:</p>
                <pre class="algo-formula">inkomen = max(0, werkelijk rendement − heffingsvrij × partnerMultiplier)</pre>
                <p>Bij negatief werkelijk rendement wordt het verlies ongewijzigd doorgegeven.</p>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">b</span>
              <div>
                <strong>Stap 2 — Verliesverrekening (carry-forward)</strong>
                <p>Als het inkomen <strong>negatief</strong> is en het absoluut verlies de verliesdrempel overschrijdt, wordt het verlies toegevoegd aan de verliespot:</p>
                <pre class="algo-formula">als |inkomen| &gt; drempel × partnerMultiplier:
    verliespot += |inkomen|</pre>
                <p>Als het inkomen <strong>positief</strong> is, wordt eerst de opgebouwde verliespot verrekend:</p>
                <pre class="algo-formula">verrekend = min(verliespot, inkomen)
verliespot −= verrekend
belastbaar = inkomen − verrekend</pre>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">c</span>
              <div>
                <strong>Stap 3 — Belasting</strong>
                <pre class="algo-formula">belasting = max(0, belastbaar inkomen) × tarief / 100</pre>
              </div>
            </div>
          </div>
        </div>

        <hr class="algo-divider" />

        <!-- Shared mechanics -->
        <div class="algo-block">
          <h3>7. Gedeelde mechanismen</h3>
          <div class="algo-steps">
            <div class="algo-step">
              <span class="algo-step-num">A</span>
              <div>
                <strong>Fiscale partner</strong>
                <p>Wanneer de fiscale partner toggle actief is, worden alle vrijstellingen en drempels verdubbeld (<code>partnerMultiplier = 2</code>).</p>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">B</span>
              <div>
                <strong>Peildatum</strong>
                <p>Het oude en huidige systeem gebruiken het vermogen op <strong>1 januari</strong> (begin van het jaar) als heffingsgrondslag. Het toekomstige systeem werkt met het werkelijke rendement over het gehele jaar.</p>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">C</span>
              <div>
                <strong>Markdata</strong>
                <p>Historische rendementen zijn beschikbaar voor: S&amp;P 500 (Total Return, USD), AEX (Gross Return, EUR), MSCI All World (Total Return, USD), en Ethereum (USD). Alle rendementen zijn inclusief dividenden / total return.</p>
              </div>
            </div>
            <div class="algo-step">
              <span class="algo-step-num">D</span>
              <div>
                <strong>Geen belasting-scenario</strong>
                <p>Het "Geen belasting"-scenario returnt altijd € 0 belasting en dient als benchmark om de impact van elk belastingstelsel te isoleren.</p>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <main class="main">
      <!-- Quick Controls Bar -->
      <section class="controls-bar">
        <div class="controls-row">
          <div class="control-group">
            <label for="startCapital">Startkapitaal</label>
            <div class="input-with-prefix">
              <span class="prefix">€</span>
              <input type="number" id="startCapital" value="150000" min="0" step="1000" />
            </div>
          </div>

          <div class="control-group">
            <label for="monthlyContribution">Maandelijkse inleg</label>
            <div class="input-with-prefix">
              <span class="prefix">€</span>
              <input type="number" id="monthlyContribution" value="0" min="0" step="100" />
            </div>
            <p class="control-help">Wordt aan het einde van elke maand ingelegd.</p>
            <div class="cpi-toggle-row">
              <span>CPI correctie</span>
              <label class="toggle">
                <input type="checkbox" id="cpiToggle" />
                <span class="toggle-slider"></span>
              </label>
              <button type="button" class="info-link" id="cpiInfoBtn">Bekijk CPI tabel</button>
            </div>
          </div>

          <div class="control-group">
            <label for="indexSelect">Index</label>
            <select id="indexSelect">
              <option value="sp500" selected>S&P 500 (Total Return)</option>
              <option value="aex">AEX (Gross Return)</option>
              <option value="allworld">MSCI All World (Total Return)</option>
              <option value="ethereum">Ethereum — Volatiel Voorbeeld</option>
              <option value="custom">Eigen data</option>
            </select>
          </div>

          <div class="control-group">
            <label for="yearRange">Periode</label>
            <div class="range-group">
              <select id="yearStart"></select>
              <span class="range-sep">→</span>
              <select id="yearEnd"></select>
            </div>
            <p class="control-help" id="periodYearsIndicator"></p>
          </div>

          <div class="control-group">
            <label for="fiscalPartner">Huishouden</label>
            <div class="partner-toggle-row">
              <span>Fiscale partner</span>
              <label class="toggle">
                <input type="checkbox" id="fiscalPartner" />
                <span class="toggle-slider"></span>
              </label>
            </div>
            <p class="control-help">Verdubbelt vrijstellingen en drempels.</p>
          </div>
        </div>
      </section>

      <nav class="sub-nav">
        <a href="/data.html" class="nav-link">Marktdata bekijken →</a>
      </nav>

      <!-- Tax Systems Config (with toggles) -->
      <section class="config-section">
        <h2 class="section-title">Belastingsystemen</h2>

        <!-- No Tax -->
        <details class="config-accordion" data-system="noTax">
          <summary class="config-header">
            <label class="toggle" onclick="event.stopPropagation()">
              <input type="checkbox" class="system-toggle" data-system="noTax" />
              <span class="toggle-slider"></span>
            </label>
            <span class="config-dot" style="background: var(--clr-no-tax)"></span>
            Geen belasting
            <span class="config-hint">instellingen</span>
          </summary>
          <div class="config-body">
            <p class="config-note">Geen parameters nodig — dit scenario berekent je vermogen zonder enige belasting.</p>
          </div>
        </details>

        <!-- Old System -->
        <details class="config-accordion" data-system="old">
          <summary class="config-header">
            <label class="toggle" onclick="event.stopPropagation()">
              <input type="checkbox" class="system-toggle" data-system="old" />
              <span class="toggle-slider"></span>
            </label>
            <span class="config-dot" style="background: var(--clr-old)"></span>
            Oud systeem (vóór 2017)
            <span class="config-hint">instellingen</span>
          </summary>
          <div class="config-body">
            <div class="config-grid">
              <div class="config-field">
                <label for="oldDeemedReturn">Forfaitair rendement</label>
                <div class="input-with-suffix"><input type="number" id="oldDeemedReturn" value="4" step="0.1" min="0" /><span>%</span></div>
              </div>
              <div class="config-field">
                <label for="oldTaxRate">Belastingtarief</label>
                <div class="input-with-suffix"><input type="number" id="oldTaxRate" value="30" step="0.1" min="0" /><span>%</span></div>
              </div>
              <div class="config-field">
                <label for="oldExemption">Heffingsvrij vermogen</label>
                <div class="input-with-prefix"><span>€</span><input type="number" id="oldExemption" value="21139" step="100" min="0" /></div>
              </div>
            </div>
          </div>
        </details>

        <!-- Old Method (2017-2022) -->
        <details class="config-accordion" data-system="oldMethod">
          <summary class="config-header">
            <label class="toggle" onclick="event.stopPropagation()">
              <input type="checkbox" class="system-toggle" data-system="oldMethod" />
              <span class="toggle-slider"></span>
            </label>
            <span class="config-dot" style="background: #9b59b6"></span>
            Oude methode (2017–2022)
            <span class="config-hint">instellingen</span>
          </summary>
          <div class="config-body">
            <div class="config-grid">
              <div class="config-field">
                <label for="oldMethodYear">Voorinstellingen per jaar</label>
                <select id="oldMethodYear">
                  <option value="2022" selected>2022</option>
                  <option value="2021">2021</option>
                  <option value="2020">2020</option>
                  <option value="2019">2019</option>
                  <option value="2018">2018</option>
                  <option value="2017">2017</option>
                </select>
              </div>
              <div class="config-field">
                <label for="omTaxRate">Belastingtarief</label>
                <div class="input-with-suffix"><input type="number" id="omTaxRate" value="31" step="0.1" min="0" /><span>%</span></div>
              </div>
              <div class="config-field">
                <label for="omExemption">Heffingsvrij vermogen</label>
                <div class="input-with-prefix"><span>€</span><input type="number" id="omExemption" value="50650" step="100" min="0" /></div>
              </div>
              <div class="config-field">
                <label for="omSavingsRate">Spaartarief</label>
                <div class="input-with-suffix"><input type="number" id="omSavingsRate" value="-0.01" step="0.01" /><span>%</span></div>
              </div>
              <div class="config-field">
                <label for="omInvestRate">Beleggingstarief</label>
                <div class="input-with-suffix"><input type="number" id="omInvestRate" value="5.53" step="0.01" min="0" /><span>%</span></div>
              </div>
              <div class="config-field">
                <label for="omBracket1">Schijf 1 grens</label>
                <div class="input-with-prefix"><span>€</span><input type="number" id="omBracket1" value="50651" step="1" min="0" /></div>
              </div>
              <div class="config-field">
                <label for="omBracket2">Schijf 2 grens</label>
                <div class="input-with-prefix"><span>€</span><input type="number" id="omBracket2" value="962351" step="1" min="0" /></div>
              </div>
            </div>
            <p class="config-note">Schijf 1: 67% sparen / 33% beleggen. Schijf 2: 21% / 79%. Schijf 3: 100% beleggen.</p>
          </div>
        </details>

        <!-- Current System -->
        <details class="config-accordion" data-system="current">
          <summary class="config-header">
            <label class="toggle" onclick="event.stopPropagation()">
              <input type="checkbox" class="system-toggle" data-system="current" checked />
              <span class="toggle-slider"></span>
            </label>
            <span class="config-dot" style="background: var(--clr-current)"></span>
            Huidig systeem (overbruggingswet)
            <span class="config-hint">instellingen</span>
          </summary>
          <div class="config-body">
            <div class="config-grid">
              <div class="config-field">
                <label for="curTaxRate">Belastingtarief</label>
                <div class="input-with-suffix"><input type="number" id="curTaxRate" value="36" step="0.1" min="0" /><span>%</span></div>
              </div>
              <div class="config-field">
                <label for="curExemption">Heffingsvrij vermogen</label>
                <div class="input-with-prefix"><span>€</span><input type="number" id="curExemption" value="59357" step="100" min="0" /></div>
              </div>
              <div class="config-field">
                <label for="curSavingsRate">Forfait spaargeld</label>
                <div class="input-with-suffix"><input type="number" id="curSavingsRate" value="1.28" step="0.01" min="0" /><span>%</span></div>
              </div>
              <div class="config-field">
                <label for="curInvestRate">Forfait beleggingen</label>
                <div class="input-with-suffix"><input type="number" id="curInvestRate" value="6.00" step="0.01" min="0" /><span>%</span></div>
              </div>
              <div class="config-field">
                <label for="curDebtRate">Forfait schulden</label>
                <div class="input-with-suffix"><input type="number" id="curDebtRate" value="2.70" step="0.01" min="0" /><span>%</span></div>
              </div>
              <div class="config-field">
                <label for="curDebtThreshold">Drempel schulden</label>
                <div class="input-with-prefix"><span>€</span><input type="number" id="curDebtThreshold" value="3800" step="100" min="0" /></div>
              </div>
              <div class="config-field full-width">
                <label>Verdeling vermogen</label>
                <div class="allocation-group">
                  <div class="alloc-item">
                    <label for="curAllocSavings">Spaargeld</label>
                    <div class="input-with-suffix"><input type="number" id="curAllocSavings" value="0" step="1" min="0" max="100" /><span>%</span></div>
                  </div>
                  <div class="alloc-item">
                    <label for="curAllocInvest">Beleggingen</label>
                    <div class="input-with-suffix"><input type="number" id="curAllocInvest" value="100" step="1" min="0" max="100" /><span>%</span></div>
                  </div>
                  <div class="alloc-item">
                    <label for="curAllocDebt">Schulden</label>
                    <div class="input-with-suffix"><input type="number" id="curAllocDebt" value="0" step="1" min="0" max="100" /><span>%</span></div>
                  </div>
                </div>
              </div>
            </div>
            <button type="button" class="info-link" id="curInfoBtn">Hoe wordt dit berekend?</button>
          </div>
        </details>

        <!-- Future System 2028 -->
        <details class="config-accordion" data-system="future">
          <summary class="config-header">
            <label class="toggle" onclick="event.stopPropagation()">
              <input type="checkbox" class="system-toggle" data-system="future" checked />
              <span class="toggle-slider"></span>
            </label>
            <span class="config-dot" style="background: var(--clr-future)"></span>
            Toekomstig systeem (2028+)
            <span class="config-hint">instellingen</span>
          </summary>
          <div class="config-body">
            <div class="config-grid">
              <div class="config-field">
                <label for="futTaxRate">Belastingtarief</label>
                <div class="input-with-suffix"><input type="number" id="futTaxRate" value="36" step="0.1" min="0" /><span>%</span></div>
              </div>
              <div class="config-field">
                <label for="futFreeReturn">Vrijgesteld rendement</label>
                <div class="input-with-prefix"><span>€</span><input type="number" id="futFreeReturn" value="1800" step="100" min="0" /></div>
              </div>
              <div class="config-field">
                <label for="futLossThreshold">Verliesdrempel</label>
                <div class="input-with-prefix"><span>€</span><input type="number" id="futLossThreshold" value="500" step="100" min="0" /></div>
              </div>
            </div>
            <button type="button" class="info-link" id="futInfoBtn">Hoe wordt dit berekend?</button>
          </div>
        </details>
      </section>

      <!-- Charts Section -->
      <section class="charts-section">
        <div class="chart-card">
          <div class="chart-header">
            <h2>Vermogensgroei</h2>
            <p class="chart-desc">De waarde van je portfolio over tijd onder elk belastingregime</p>
          </div>
          <div class="chart-container">
            <canvas id="chartPortfolio"></canvas>
          </div>
        </div>

        <!-- Summary Cards (right below Vermogensgroei) -->
        <section class="summary-section" id="summarySection">
          <div class="summary-overview" id="summaryGrid">
            <!-- Filled by JS -->
          </div>
        </section>

        <div class="chart-card">
          <div class="chart-header">
            <h2>Jaarlijkse belasting</h2>
            <p class="chart-desc">Hoeveel belasting je per jaar betaalt</p>
          </div>
          <div class="chart-container">
            <canvas id="chartAnnualTax"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-header">
            <h2>Totaal betaalde belasting</h2>
            <p class="chart-desc">Cumulatieve belasting over de gehele periode</p>
          </div>
          <div class="chart-container">
            <canvas id="chartTotalTax"></canvas>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <p>
        Disclaimer: Deze tool is uitsluitend bedoeld ter illustratie. Raadpleeg
        een belastingadviseur voor persoonlijk advies.
      </p>
      <p class="footer-credit">
        Gemaakt door
        <a href="https://www.linkedin.com/in/hylkej/" target="_blank">Hylke Jellema</a>
        voor <a href="https://debelegger.nl" target="_blank" rel="noopener noreferrer">DeBelegger</a>
      </p>
    </footer>

    <!-- Info modal: Future box 3 calculations -->
    <div class="modal-overlay" id="futureInfoModal" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="futureInfoTitle">
        <div class="modal-header">
          <h3 id="futureInfoTitle">Toekomstig Box 3 (2028+) rekenmethode</h3>
          <button type="button" class="modal-close" id="futureInfoClose" aria-label="Sluiten">x</button>
        </div>
        <div class="modal-body">
          <p class="modal-lead">Deze simulator rekent dit scenario als een eenvoudige belasting op werkelijk rendement (illustratief).</p>
          <ol class="modal-list">
            <li><strong>Jaarresultaat:</strong> per maand rendement (afgeleid van jaarreturn) + maandelijkse inleg (einde maand).</li>
            <li><strong>Heffingsvrij resultaat:</strong> alleen bij positief resultaat: max(0, resultaat − vrijstelling).</li>
            <li><strong>Verlies (carry-forward):</strong> bij negatief resultaat wordt het verlies toegevoegd aan een verliespot, maar alleen als het verlies groter is dan de verliesdrempel.</li>
            <li><strong>Verrekening:</strong> in een positief jaar wordt de verliespot eerst verrekend met het positieve inkomen (na vrijstelling).</li>
            <li><strong>Belasting:</strong> belastbaar inkomen × tarief.</li>
          </ol>
          <p class="modal-note">Als je “Fiscale partner” aanzet, worden de vrijstelling en verliesdrempel verdubbeld.</p>
        </div>
      </div>
    </div>

    <!-- Info modal: Current box 3 calculations -->
    <div class="modal-overlay" id="currentInfoModal" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="currentInfoTitle">
        <div class="modal-header">
          <h3 id="currentInfoTitle">Huidig Box 3 (overbruggingswet) rekenmethode</h3>
          <button type="button" class="modal-close" id="currentInfoClose" aria-label="Sluiten">x</button>
        </div>
        <div class="modal-body">
          <p class="modal-lead">De berekening volgens de huidige overbruggingswetgeving werkt als volgt:</p>
          <ol class="modal-list">
            <li><strong>Vermogensmix:</strong> Je vermogen wordt (in dit model automatisch of handmatig) verdeeld over spaargeld, beleggingen en schulden.</li>
            <li><strong>Forfaitair rendement:</strong> Elk onderdeel heeft een eigen fictief percentage (bijv. 6,00% voor beleggen).</li>
            <li><strong>Totaal forfaitair rendement:</strong> Wordt berekend door de mix te vermenigvuldigen met deze percentages.</li>
            <li><strong>Rendementsgrondslag:</strong> Je totale vermogen zónder heffingsvrij vermogen.</li>
            <li><strong>Belastbaar rendement:</strong> (Rendementsgrondslag / Totale vermogen) × Totaal forfaitair rendement.</li>
            <li><strong>Belasting:</strong> Belastbaar rendement × tarief.</li>
          </ol>
          <p class="modal-note">Als je “Fiscale partner” aanzet, wordt het heffingsvrij vermogen verdubbeld. Schulden tellen mee na aftrek van de drempel.</p>
        </div>
      </div>
    </div>

    <!-- CPI Inflation Modal -->
    <div class="modal-overlay" id="cpiModal" aria-hidden="true">
      <div class="modal modal-wide" role="dialog" aria-modal="true" aria-labelledby="cpiModalTitle">
        <div class="modal-header">
          <h3 id="cpiModalTitle">CPI Inflatie Correctie</h3>
          <button type="button" class="modal-close" id="cpiModalClose" aria-label="Sluiten">x</button>
        </div>
        <div class="modal-body">
          <p class="modal-lead">De maandelijkse inleg wordt jaarlijks gecorrigeerd voor inflatie op basis van CPI data van het CBS.</p>
          <div id="cpiTableContainer"></div>
          <p class="modal-note">Bron: CBS (Centraal Bureau voor de Statistiek)</p>
        </div>
      </div>
    </div>

    <script type="module" src="/js/app.js"></script>
  </body>
</html>
